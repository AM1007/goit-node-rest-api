# Contacts Management REST API with Authentication

[back](./README.md)

An enhanced version of the contacts management REST API now featuring user authentication and authorization to secure contact data.

## New Authentication Features

The API now includes a complete authentication system:

- User registration
- User login with JWT token generation
- Access to protected routes via token verification
- User logout
- User-specific contact management (users can only access their own contacts)

## Technology Additions

- **bcrypt:** Password hashing and comparison
- **jsonwebtoken:** JWT token generation and verification
- **User model:** Database storage for user accounts

## Authentication API Routes

### POST /api/auth/register

Register a new user.

- **Request Body:**

```json
{
  "username": "Username",
  "email": "email@example.com",
  "password": "password123"
}
```

- **Validation:**
  - Username is required
  - Email must be valid and unique
  - Password must be at least 6 characters
- **Response:** Created user data (without password)
- **Status:** 201 Created or 409 Conflict if email exists

### POST /api/auth/login

Authenticate a user and return a JWT token.

- **Request Body:**

```json
{
  "email": "email@example.com",
  "password": "password123"
}
```

- **Response:** JWT token and user data
- **Status:** 200 OK or 401 Unauthorized

### GET /api/auth/current

Get information about the currently authenticated user.

- **Headers:** Authorization: Bearer token
- **Response:** Current user data
- **Status:** 200 OK or 401 Unauthorized

### POST /api/auth/logout

Log out the currently authenticated user (invalidate token).

- **Headers:** Authorization: Bearer token
- **Response:** No content
- **Status:** 204 No Content or 401 Unauthorized

## Contact Management Updates

All contact management routes are now protected and require authentication:

- Contacts are associated with the authenticated user
- Users can only view, modify, and delete their own contacts
- The Contact model now includes an `owner` field to associate with users

## Authentication Flow

1. User registers an account
2. User logs in to receive a JWT token
3. Token is included in the Authorization header for subsequent requests
4. Server verifies the token before processing requests
5. User can log out to invalidate the token

## User Model

```javascript
{
  id: "integer", // Auto-generated by Sequelize
  email: "string", // Required, unique, validated format
  password: "string", // Required, hashed with bcrypt
  subscription: "enum", // Values: starter, pro, business; Default: starter
  token: "string", // JWT token, null when logged out
  createdAt: "date", // Auto-generated by Sequelize
  updatedAt: "date" // Auto-generated by Sequelize
}
```

## Security Features

- Password hashing with bcrypt
- JWT token generation with 24-hour expiration
- Token verification middleware
- User-specific data access control
- Secure error messages (no leaking of sensitive information)
